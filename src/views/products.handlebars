<div class="box">
    <h1>Productos</h1>
    <hr>

    <!-- PROFE LE AGREGO LOS COMENTARIOS PARA UBICARLO: FORMULARIO DE CREACIÓN  -->
    <div class="products-form">
        <h2>Crear Producto</h2>
        <form>
            <label for="title">Título</label>
            <input name="title" id="title" type="text">

            <label for="description">Descripción</label>
            <input name="description" id="description" type="text">

            <label for="price">Precio</label>
            <input name="price" id="price" type="number">

            <label for="stock">Stock</label>
            <input name="stock" id="stock" type="number">

            <label for="category">Categoría</label>
            <input name="category" id="category" type="text">

            <label for="code">Código</label>
            <input name="code" id="code" type="text">

            <button id="button-create" onclick="createProduct(event)">Crear</button>
        </form>
    </div>

    <hr>

    <div class="products-box">
        {{#each products}}
            <div class="product-card">
                <h3>{{this.title}}</h3>
                <hr>
                <p>Categoría: {{this.category}}</p>
                <p>Descripción: {{this.description}}</p>
                <p>Precio: $ {{this.price}}</p>
                <p>Código: {{this.code}}</p>

                <button id="button-delete" onclick="deleteProduct('{{this._id}}')">Eliminar</button>

                <a href="/products/{{this._id}}">
                    <button id="button-detail" type="button">Ver detalle</button>
                </a>

                <button id="button-add-cart" onclick="addToCart('{{this._id}}')" type="button">Agregar al carrito</button>
            </div>
        {{/each}}
    </div>

    <!-- PAGINACIÓN -->
    <div class="pagination">
        {{#if hasPrevPage}}
            <a href="?page={{prevPage}}&limit=10" class="pagination-link">← Anterior</a>
        {{/if}}

        <span>Página {{page}} de {{totalPages}}</span>

        {{#if hasNextPage}}
            <a href="?page={{nextPage}}&limit=10" class="pagination-link">Siguiente →</a>
        {{/if}}
    </div>
</div>

<script>
    function createProduct(e) {
        e.preventDefault();

        const newProduct = {
            title: document.getElementById('title').value,
            description: document.getElementById('description').value,
            price: document.getElementById('price').value,
            stock: document.getElementById('stock').value,
            category: document.getElementById('category').value,
            code: document.getElementById('code').value // <-- ¡Ahora sí!
        };

        fetch('/api/products', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(newProduct)
        })
        .then(res => res.json())
        .then(data => {
            alert("Producto creado");
            location.reload();
        })
        .catch(error => {
            console.error("Error al crear producto:", error);
        });
    }

    function deleteProduct(productId) {
        fetch(`/api/products/${productId}`, {
            method: 'DELETE'
        })
        .then(res => res.json())
        .then(data => {
            alert("Producto eliminado");
            location.reload();
        })
        .catch(error => {
            console.error("Error al eliminar producto:", error);
        });
    }

    function addToCart(productId) {
        
        const cartId = 'AQUI_EL_ID_REAL_DEL_CARRITO';
        fetch(`/api/carts/${cartId}/products/${productId}`, {
            method: 'POST'
        })
        .then(res => res.json())
        .then(data => {
            if (data.status === 'success') {
                alert("Producto agregado al carrito");
            } else {
                alert("No se pudo agregar al carrito: " + data.message);
            }
        })
        .catch(error => {
            console.error("Error al agregar al carrito:", error);
        });
    }
</script>